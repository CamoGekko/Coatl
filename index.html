<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coatl</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    
    <header>
        <h1>Coatl</h1>
    </header>

    <main>
        <section>
            <h2>Create Post</h2>
            <div>
                <label for="author">Name:</label><br>
                <input type="text" id="author" required><br><br>
                
                <label for="message">Post:</label><br>
                <textarea id="message" rows="4" required></textarea><br><br>
                
                <button onclick="submitPost()">Post</button>
            </div>
        </section>
        
        <section id="postsSection">
            <h2>Recent Posts</h2>
            <!-- Posts will be loaded here by JS -->
        </section>
    </main>

    <footer>
        <p>&copy; <?php echo date("Y"); ?> Coatl</p>
    </footer>

    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-analytics.js";
      import { getFirestore, collection, addDoc, orderBy, serverTimestamp, getDocs } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-firestore.js";
    
      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
        apiKey: "AIzaSyAu5eH-8OEAunh1jjIzoqd9-CDtHULMqyY",
        authDomain: "coatl-cc1f4.firebaseapp.com",
        projectId: "coatl-cc1f4",
        storageBucket: "coatl-cc1f4.appspot.com",
        messagingSenderId: "290464623435",
        appId: "1:290464623435:web:13a2418fa9e5890dae96ce",
        measurementId: "G-R3BFTJ7HD7"
      };
    
      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const db = getFirestore(app);

      // Function to submit a post
      function submitPost() {
        const authorInput = document.getElementById('author');
        const messageInput = document.getElementById('message');

        addDoc(collection(db, "posts"), {
            author: authorInput.value,
            message: messageInput.value,
            timestamp: serverTimestamp()
        })
        .then(() => {
            console.log("Document successfully written!");
            authorInput.value = ''; // clear the input after successful submission
            messageInput.value = ''; // clear the input after successful submission
        })
        .catch((error) => {
            console.error("Error writing document: ", error);
        });
      }

      // Function to load and display posts
      async function loadPosts() {
        const postsSection = document.getElementById("postsSection");
        postsSection.innerHTML = '<h2>Recent Posts</h2>'; // Reset the section

        const querySnapshot = await getDocs(orderBy(collection(db, "posts"), "timestamp", "desc"));

        querySnapshot.forEach((doc) => {
            const post = doc.data();
            const postElement = document.createElement("div");
            postElement.innerHTML = `<div class='post'><h3>${post.author}</h3><p>${post.message}</p></div>`;
            postsSection.appendChild(postElement);
        });
      }

      // Call loadPosts on script load to display posts
      loadPosts();
    </script>
</body>
</html>
